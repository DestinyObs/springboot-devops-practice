# Ansible Configuration Management

This directory contains Ansible playbooks and roles for configuring the User Registration Microservice infrastructure.

## What Ansible Does

**Terraform** provisions the infrastructure, **Ansible** configures it:

- âœ… **System Updates** (apt packages, security updates)
- âœ… **Java 17** installation and configuration
- âœ… **Maven** installation and setup
- âœ… **Docker & Docker Compose** installation
- âœ… **Application User** and directory setup
- âœ… **Security Hardening** (firewall, limits, etc.)
- âœ… **Service Configuration** (systemd, logging)

## ğŸ“ Directory Structure

```
ansible/
â”œâ”€â”€ ansible.cfg             # Ansible configuration
â”œâ”€â”€ inventory/              # Environment inventories
â”‚   â”œâ”€â”€ dev.ini.tpl        # Template for dev inventory
â”‚   â””â”€â”€ dev.ini            # Generated by Terraform
â”œâ”€â”€ playbooks/             # Main playbooks
â”‚   â””â”€â”€ site.yml          # Main configuration playbook
â””â”€â”€ roles/                 # Reusable roles
    â”œâ”€â”€ common/           # System basics
    â”œâ”€â”€ java/            # Java installation
    â”œâ”€â”€ docker/          # Docker setup
    â”œâ”€â”€ maven/           # Maven installation
    â””â”€â”€ app-setup/       # Application configuration
```

## Automated Execution

**Terraform automatically runs Ansible** after infrastructure provisioning:

1. **Terraform** creates EC2 instances
2. **Terraform** generates Ansible inventory with instance IPs
3. **Terraform** waits 60 seconds for instance boot
4. **Terraform** executes `ansible-playbook` automatically

## Manual Execution (if needed)

```bash
# Navigate to ansible directory
cd devops/ansible

# Run playbook for dev environment
ansible-playbook -i inventory/dev.ini playbooks/site.yml

# Run with verbose output
ansible-playbook -i inventory/dev.ini playbooks/site.yml -v

# Check connectivity
ansible -i inventory/dev.ini app_servers -m ping
```

## ğŸ“‹ Prerequisites

- Ansible installed on local machine
- SSH key generated by Terraform
- EC2 instances provisioned and accessible

## What Gets Installed

After Ansible runs, your server will have:

| Component | Version | Purpose |
|-----------|---------|---------|
| **Java** | OpenJDK 17 | Spring Boot runtime |
| **Maven** | 3.9.6 | Build tool |
| **Docker** | Latest CE | Container runtime |
| **Docker Compose** | 2.24.0 | Multi-container orchestration |
| **Git** | Latest | Source code management |
| **System Tools** | curl, wget, htop, etc. | Administration |

## ğŸ” Security Features

- Application user with limited privileges
- Docker group membership for container management
- System resource limits configuration
- Log rotation setup
- Security package updates

## Verification

After Ansible completes, you can verify the installation:

```bash
# SSH to your instance
ssh -i user-registration-dev-key.pem ubuntu@<instance-ip>

# Check installed versions
java -version
mvn -version
docker --version
docker-compose --version

# Check services
sudo systemctl status docker
```

---

**Next Phase**: CI/CD Pipeline setup with Jenkins!
