# Ansible Configuration

This directory contains Ansible playbooks and roles for configuring servers provisioned by Terraform for the Spring Boot user registration/authentication microservice.

## Overview

Ansible handles server configuration and software installation after Terraform provisions the infrastructure. Terraform creates EC2 instances, VPC, security groups, and load balancers, while Ansible configures the servers with required software and services.

## Directory Structure

```
devops/ansible/
├── ansible.cfg                    # Ansible configuration
├── playbooks/
│   └── site.yml                  # Main playbook
├── roles/
│   ├── common/                   # System updates and basic configuration
│   ├── java/                     # Java installation and setup
│   ├── docker/                   # Docker installation and configuration
│   ├── maven/                    # Maven installation and setup
│   └── jenkins/                  # Jenkins installation and configuration
├── inventory/
│   └── dev.ini                   # Generated by Terraform depending on env
└── group_vars/
    └── dev.yml                   # Generated by Terraform depending on env
```

## Integration with Terraform

Ansible runs automatically after Terraform provisions infrastructure:

1. Terraform creates EC2 instances and generates SSH keys
2. Terraform creates `inventory/dev.ini` with instance details
3. Terraform creates `group_vars/dev.yml` with environment variables
4. Terraform executes Ansible playbook via local-exec provisioner

## Roles

**Common**: System updates, essential packages, user management

**Java**: OpenJDK installation, environment variables, version verification

**Docker**: Docker Engine installation, service configuration, user permissions

**Maven**: Apache Maven installation, environment configuration

**Jenkins**: Jenkins installation, initial configuration, service management

## Usage

### Automatic Execution (Standard)
```bash
cd devops/terraform/environments/dev
terraform init
terraform apply
```

### Manual Execution
```bash
cd devops/ansible
ansible-playbook -i inventory/dev.ini playbooks/site.yml
```

## Environment Support

Supports multiple environments through:
- Environment-specific inventory files
- Environment-specific group variables
- Consistent role structure across environments

## Prerequisites

- Ansible installed on control machine
- SSH access to target instances
- Terraform-generated SSH keys

## Configuration

**ansible.cfg**: Ansible settings, inventory location, SSH configuration

**site.yml**: Main playbook orchestrating role execution

## Security

- SSH keys generated automatically by Terraform
- Private key permissions set to 600
- Host key checking configured for cloud environments
- Least-privilege service account permissions